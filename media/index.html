<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <title>Flipper Webview</title>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@2.5.1/dist/jsoneditor.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/editor/editor.main.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js"></script>
</head>

<body>
    <nav>
        <ul>
            <li><button onclick="toggleDiv('JSON')" alt="JSON Button">JSON</button></li>
            <li><button onclick="toggleDiv('TMP')" alt="Template Button">Template</button></li>
        </ul>
    </nav>

    <div id="JSON" style="display: block; height: 600px;">NS app in json form</div>
    <div id="TMP" style="display: block;">This is fast template html</div>

    <script>

        // example NS app as json
        const nsJson = { "name": "fn-2187-vip_http", "protocol": "HTTP", "ipAddress": "208.208.208.13", "type": "lb", "opts": { "-persistenceType": "NONE", "-cltTimeout": "180" }, "port": "80", "lines": ["add lb vserver fn-2187-vip_http HTTP 208.208.208.13 80 -persistenceType NONE -cltTimeout 180 -devno 70647808", "bind lb vserver fn-2187-vip_http fn-2187_http_svg", "add serviceGroup fn-2187_http_svg HTTP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -cltTimeout 180 -svrTimeout 360 -CKA NO -TCPB NO -CMP YES -devno 63504384", "bind serviceGroup fn-2187_http_svg bb8-03.jaku.dev 80 -devno 111411200", "add server bb8-03.jaku.dev bb8-03.jaku.dev -devno 11764", "bind serviceGroup fn-2187_http_svg bb8-01.jaku.dev 80 -state DISABLED -devno 111345664", "add server bb8-01.jaku.dev bb8-01.jaku.dev -state DISABLED -devno 11761", "bind serviceGroup fn-2187_http_svg bb8-05 80 -state DISABLED -devno 111312896", "add server bb8-05 28.28.28.97 -state DISABLED -devno 11819", "bind serviceGroup fn-2187_http_svg bb8-06.jaku.dev 80 -devno 111280128", "add server bb8-06.jaku.dev 28.28.28.96 -devno 11684", "bind serviceGroup fn-2187_http_svg bb8-08 80 -devno 111247360", "add server bb8-08 28.28.28.40 -devno 11821", "bind serviceGroup fn-2187_http_svg bb8-07.jaku.dev 80 -devno 111214592", "add server bb8-07.jaku.dev 28.28.28.39 -devno 11685", "bind serviceGroup fn-2187_http_svg bb8-09.jaku.dev 80 -devno 111181824", "add server bb8-09.jaku.dev 28.28.28.29 -devno 11728", "bind serviceGroup fn-2187_http_svg -monitorName HTTP -devno 524564", "bind serviceGroup fn-2187_http_svg -monitorName tcp -devno 5296", "bind serviceGroup fn-2187_http_svg -monitorName ping -devno 111448"], "bindings": { "serviceGroup": [{ "name": "fn-2187_http_svg", "protocol": "HTTP", "-maxClient": "0", "-maxReq": "0", "-cip": "DISABLED", "-usip": "NO", "-useproxyport": "YES", "-cltTimeout": "180", "-svrTimeout": "360", "-CKA": "NO", "-TCPB": "NO", "-CMP": "YES", "servers": [{ "name": "bb8-03.jaku.dev", "port": "80", "hostname": "bb8-03.jaku.dev" }, { "name": "bb8-01.jaku.dev", "port": "80", "hostname": "bb8-01.jaku.dev", "-state": "DISABLED" }, { "name": "bb8-05", "port": "80", "address": "28.28.28.97", "-state": "DISABLED" }, { "name": "bb8-06.jaku.dev", "port": "80", "address": "28.28.28.96" }, { "name": "bb8-08", "port": "80", "address": "28.28.28.40" }, { "name": "bb8-07.jaku.dev", "port": "80", "address": "28.28.28.39" }, { "name": "bb8-09.jaku.dev", "port": "80", "address": "28.28.28.29" }], "monitors": [{ "name": "HTTP" }, { "name": "tcp" }, { "name": "ping" }] }], "certs": [{}] }, "diagnostics": [], "fastTempParams": { "tenant_name": "fn-2187-vip_http", "app_name": "fn-2187-vip_http", "type": "lb", "protocol": "HTTP", "virtual_address": "208.208.208.13", "virtual_port": "80", "pool_members": [{ "fqdn": { "hostname": "bb8-03.jaku.dev", "name": "bb8-03.jaku.dev", "port": "80" } }, { "fqdn": { "hostname": "bb8-01.jaku.dev", "name": "bb8-01.jaku.dev", "port": "80", "state": "DISABLED" } }, { "address": { "name": "bb8-05", "address": "28.28.28.97", "port": "80", "state": "DISABLED" } }, { "address": { "name": "bb8-06.jaku.dev", "address": "28.28.28.96", "port": "80" } }, { "address": { "name": "bb8-08", "address": "28.28.28.40", "port": "80" } }, { "address": { "name": "bb8-07.jaku.dev", "address": "28.28.28.39", "port": "80" } }, { "address": { "name": "bb8-09.jaku.dev", "address": "28.28.28.29", "port": "80" } }], "monitors": [{ "name": "HTTP" }, { "name": "tcp" }, { "name": "ping" }], "persistence": { "NONE": "NONE" }, "idleTimeout": "180" } }
        const templateSchema = { "type": "object", "properties": { "idleTimeout": { "type": "string", "default": 300 }, "virtual_address": { "type": "string" }, "app_name": { "type": "string" }, "persistence": { "type": "array", "items": { "type": "object", "properties": { "SOURCEIP": { "type": "array", "items": { "type": "string" }, "skip_xform": true }, "COOKIEINSERT": { "type": "array", "items": { "type": "string" }, "skip_xform": true }, "SSLSESSION": { "type": "array", "items": { "type": "string" }, "skip_xform": true }, "NONE": { "type": "array", "items": { "type": "string" }, "skip_xform": true } }, "required": ["SOURCEIP", "COOKIEINSERT", "SSLSESSION", "NONE"] }, "skip_xform": true }, "virtual_port": { "type": "string" }, "pool_members": { "type": "array", "items": { "type": "object", "properties": { "address": { "type": "array", "items": { "type": "object", "properties": { "name": { "type": "string" }, "address": { "type": "string" }, "port": { "type": "string" } }, "required": ["name", "address", "port"] }, "skip_xform": true }, "fqdn": { "type": "array", "items": { "type": "object", "properties": { "hostname": { "type": "string" }, "port": { "type": "string" } }, "required": ["hostname", "port"] }, "skip_xform": true } }, "required": ["address", "fqdn"], "dependencies": { "name": ["address"], "port": ["address", "fqdn"], "hostname": ["fqdn"] } }, "skip_xform": true }, "lbMethod": { "type": "array", "items": { "type": "object", "properties": { "ROUNDROBIN": { "type": "array", "items": { "type": "string" }, "skip_xform": true }, "LEASTCONNECTION": { "type": "array", "items": { "type": "string" }, "skip_xform": true } }, "required": ["ROUNDROBIN", "LEASTCONNECTION"] }, "skip_xform": true } }, "required": ["virtual_address", "app_name", "persistence", "virtual_port", "pool_members"], "dependencies": { "SOURCEIP": ["persistence"], "COOKIEINSERT": ["persistence"], "SSLSESSION": ["persistence"], "NONE": ["persistence"], "address": ["pool_members"], "fqdn": ["pool_members"], "ROUNDROBIN": ["lbMethod"], "LEASTCONNECTION": ["lbMethod"] }, "title": "HTTP Application Template", "description": "24-OCT-2024", "definitions": {} }
        const defaultTemplateParams = { "idleTimeout": 300 }
        const templateParams = Object.assign(defaultTemplateParams, nsJson.fastTempParams)

        // Extract application name and ns app protocol from nsJson
        const appName = nsJson.name;
        const appProtocol = nsJson.protocol;


        // function toggleDiv(b) {
        //     var divs = document.querySelectorAll('body > div');
        //     divs.forEach(div => {
        //         if (div.id === b) {
        //             div.style.display = "block";
        //         } else {
        //             div.style.display = "none";
        //         }
        //     });
        // }
        // // Ensure the JSON div is displayed initially
        // document.addEventListener('DOMContentLoaded', (event) => {
        //     toggleDiv('JSON');
        // });

        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            var editor = monaco.editor.create(document.getElementById('JSON'), {
                language: 'json',
                theme: "vs-dark"
            });
            editor.setValue(JSON.stringify(nsJson, null, 2));

            // Update the webpage title to show the appName - appProtocol variables
            document.title = appName + ' - ' + appProtocol;
            console.log('document.title:', document.title);
        });

        // Ensure the TMP div is empty before initializing the JSONEditor
        document.getElementById('TMP').innerHTML = '';

        // Create a JSON editor for the template
        var templateEditor = new JSONEditor(document.getElementById('TMP'), {
            schema: templateSchema,
            startval: templateParams,
            compact: true,
            show_errors: 'always',
            disable_edit_json: true,
            disable_properties: true,
            disable_collapse: true,
            array_controls_top: true,
            theme: 'bootstrap4'
        });


    </script>
</body>

</html>